
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF to Quiz</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f0f0f0;
      flex-direction: column;
      text-align: center;
    }
    .hidden { display: none; }
    #loader {
      margin-top: 20px;
    }
    #quiz-container {
      display: none;
      margin-top: 20px;
    }
    #timer {
      font-size: 24px;
      font-weight: bold;
      margin: 20px 0;
    }
  </style>
</head>
<body>

  <h2>Upload PDF to Generate Quiz</h2>
  <form id="uploadForm">
    <input type="file" id="pdfFile" accept=".pdf" required />
    <br><br>
    <button type="submit">Upload PDF</button>
  </form>

  <div id="loader" class="hidden">
    <img src="https://media.tenor.com/SdR1cySgBC8AAAAC/naruto-hinata.gif" alt="Loading..." width="200">
    <p>Generating quiz... Naruto is running to Hinata!</p>
  </div>

  <div id="quiz-container">
    <div id="timer">30:00</div>
    <div id="quiz"></div>
    <div id="results" class="hidden"></div>
  </div>

  <script>
    const form = document.getElementById("uploadForm");
    const loader = document.getElementById("loader");
    const quizContainer = document.getElementById("quiz-container");
    const timerDisplay = document.getElementById("timer");
    const quizDiv = document.getElementById("quiz");
    const resultsDiv = document.getElementById("results");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const file = document.getElementById("pdfFile").files[0];
      if (!file || file.size > 100 * 1024 * 1024) {
        alert("Please upload a PDF under 100MB.");
        return;
      }

      form.classList.add("hidden");
      loader.classList.remove("hidden");

      const formData = new FormData();
      formData.append("pdf", file);

      try {
        const response = await fetch("https://quiz-backend-5k5v.onrender.com/upload", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();
        if (!data.questions || data.questions.length === 0) {
          throw new Error("No quiz generated.");
        }

        loader.classList.add("hidden");
        showQuiz(data.questions);
        startTimer(30 * 60); // 30 minutes
      } catch (err) {
        loader.classList.add("hidden");
        form.classList.remove("hidden");
        alert("Error: " + err.message);
      }
    });

    function showQuiz(questions) {
      quizContainer.style.display = "block";
      quizDiv.innerHTML = questions.map((q, i) => `
        <div>
          <p><b>Q${i + 1}:</b> ${q.question}</p>
          ${q.options.map(opt => `
            <label>
              <input type="radio" name="q${i}" value="${opt}" />
              ${opt}
            </label><br>
          `).join("")}
          <hr>
        </div>
      `).join("");
    }

    function startTimer(duration) {
      let time = duration;
      const interval = setInterval(() => {
        const minutes = String(Math.floor(time / 60)).padStart(2, '0');
        const seconds = String(time % 60).padStart(2, '0');
        timerDisplay.textContent = `${minutes}:${seconds}`;

        if (--time < 0) {
          clearInterval(interval);
          showResults();
        }
      }, 1000);
    }

    function showResults() {
      const questions = document.querySelectorAll("#quiz > div");
      let attempted = 0, correct = 0;
      questions.forEach((div, i) => {
        const selected = div.querySelector("input[type='radio']:checked");
        if (selected) {
          attempted++;
          const correctAnswer = selected.value === "correct"; // Needs your API to mark correct answers
          if (correctAnswer) correct++;
        }
      });

      const wrong = attempted - correct;
      resultsDiv.innerHTML = `
        <h3>Results</h3>
        <p>Attempted: ${attempted}</p>
        <p>Correct: ${correct}</p>
        <p>Wrong: ${wrong}</p>
      `;
      resultsDiv.classList.remove("hidden");
    }
  </script>
</body>
</html>
